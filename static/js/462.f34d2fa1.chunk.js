"use strict";(globalThis.webpackChunkmusicdex=globalThis.webpackChunkmusicdex||[]).push([[462],{35462:(e,r,a)=>{a.r(r),a.d(r,{default:()=>E});var l=a(45432),t=a(29183),s=a(70715),n=a(55323),o=a(10855),i=a(67279),c=a(28735),d=a(35790),u=a(72791),g=a(37734),h=a(7692),m=a(43504),x=a(16871),b=a(89825),f=a(96450),p=a(95798),v=a(82504),j=a(17425),y=a(9281),S=a(80184);const w=e=>{let{debounceValue:r=1e3,placeholder:a,getQuery:l,setQuery:t,value:s,tagLabel:n,autoFocus:o}=e;const{t:i}=(0,g.$)(),[c,d]=(0,u.useState)(s||""),[h,{flush:m}]=(0,y.Nr)(c,r);(0,u.useEffect)((()=>{t({value:h,query:l(h)})}),[h,l,t]),(0,u.useEffect)((()=>{d(s||"")}),[s]);const x=(0,u.useCallback)((e=>{d(e.target.value)}),[d]);return(0,S.jsxs)(S.Fragment,{children:[n&&(0,S.jsx)(f.Vp,{colorScheme:"brand",size:"md",alignSelf:"start",children:n}),(0,S.jsx)("form",{onSubmit:e=>{e.preventDefault(),m()},children:(0,S.jsxs)(p.BZ,{children:[(0,S.jsx)(p.II,{value:c,onChange:x,placeholder:a,autoFocus:o}),(0,S.jsx)(p.xH,{children:(0,S.jsx)(v.hU,{color:"brand.400",colorScheme:"brand",size:"sm",variant:"ghost","aria-label":i("Search"),icon:(0,S.jsx)(j.t2h,{}),type:"submit",title:i("Search")})})]})})]})};var C=a(62732);const L=e=>{var r,a,l,t;let{dataField:s,placeholder:n,showSearch:o=!1,aggregations:i,setQuery:d,value:h,tagLabel:m}=e;const{t:x}=(0,g.$)(),[b,y]=(0,u.useState)(""),[w,L]=(0,u.useState)(h),k=(0,u.useCallback)((e=>null!==e&&void 0!==e&&e.length?{query:{terms:{[s]:e}}}:{}),[s]);return(0,u.useEffect)((()=>{d({value:w,query:k(w)})}),[w,k,d]),(0,u.useEffect)((()=>{L(h||[])}),[h]),null!==i&&void 0!==i&&null!==(r=i[s])&&void 0!==r&&null!==(a=r.buckets)&&void 0!==a&&a.length?(0,S.jsxs)(S.Fragment,{children:[m&&(0,S.jsx)(f.Vp,{colorScheme:"brand",size:"md",alignSelf:"start",children:m}),o&&(0,S.jsxs)(p.BZ,{children:[(0,S.jsx)(p.II,{value:b,onChange:e=>y(e.target.value),placeholder:n}),(0,S.jsx)(p.xH,{children:b&&(0,S.jsx)(v.hU,{color:"red.400",colorScheme:"red",size:"sm",variant:"ghost","aria-label":x("Clear"),icon:(0,S.jsx)(j.tgW,{}),type:"button",title:x("Clear"),onClick:()=>y("")})})]}),(0,S.jsx)(C.cO,{value:w,onChange:e=>L(e),children:(0,S.jsx)(c.gC,{maxH:"200px",alignItems:"stretch",overflowY:"scroll",p:2,children:null===i||void 0===i||null===(l=i[s])||void 0===l||null===(t=l.buckets)||void 0===t?void 0:t.filter((e=>{let{key:r}=e;return r.toLowerCase().includes(b.toLowerCase())})).map((e=>{let{key:r}=e;return(0,S.jsx)(C.XZ,{value:r,children:r},r)}))})})]}):null};var k=a(3445);const I=e=>{var r,a,l,t;let{dataField:s,placeholder:n,showSearch:o=!1,aggregations:i,setQuery:d,value:h,tagLabel:m}=e;const{t:x}=(0,g.$)(),[b,y]=(0,u.useState)(""),[w,C]=(0,u.useState)(h),L=(0,u.useCallback)((e=>e?{query:{term:{[s]:e}}}:{}),[s]);return(0,u.useEffect)((()=>{d({value:w,query:L(w)})}),[w,L,d]),(0,u.useEffect)((()=>{C(h||"")}),[h]),null!==i&&void 0!==i&&null!==(r=i[s])&&void 0!==r&&null!==(a=r.buckets)&&void 0!==a&&a.length?(0,S.jsxs)(S.Fragment,{children:[m&&(0,S.jsx)(f.Vp,{colorScheme:"brand",size:"md",alignSelf:"start",children:m}),o&&(0,S.jsxs)(p.BZ,{children:[(0,S.jsx)(p.II,{value:b,onChange:e=>y(e.target.value),placeholder:n}),(0,S.jsx)(p.xH,{children:b&&(0,S.jsx)(v.hU,{color:"red.400",colorScheme:"red",size:"sm",variant:"ghost","aria-label":x("Clear"),icon:(0,S.jsx)(j.tgW,{}),type:"button",title:x("Clear"),onClick:()=>y("")})})]}),(0,S.jsx)(k.Ee,{value:w,onChange:e=>C(e),children:(0,S.jsx)(c.gC,{maxH:"200px",alignItems:"stretch",overflowY:"scroll",p:2,children:null===i||void 0===i||null===(l=i[s])||void 0===l||null===(t=l.buckets)||void 0===t?void 0:t.filter((e=>{let{key:r}=e;return r.toLowerCase().includes(b.toLowerCase())})).map((e=>{let{key:r}=e;return(0,S.jsx)(k.Y8,{value:r,children:r},r)}))})})]}):null},F=e=>{let{dataField:r,setQuery:a,value:l,buttons:t,tagLabel:s}=e;const[n,o]=(0,u.useState)(l),i=(0,u.useCallback)((e=>e?{query:{term:{[r]:e}}}:{}),[r]);return(0,u.useEffect)((()=>{a({value:n,query:i(n)})}),[n,i,a]),(0,u.useEffect)((()=>{o(l||"")}),[l]),(0,S.jsxs)(S.Fragment,{children:[s&&(0,S.jsx)(f.Vp,{colorScheme:"brand",size:"md",alignSelf:"start",children:s}),(0,S.jsx)(c.Ug,{children:t.map((e=>{let{label:r,value:a,icon:l}=e;return(0,S.jsx)(v.zx,{colorScheme:"brand",variant:n===a?"solid":"outline",rightIcon:l,title:r,onClick:()=>o((e=>e===a?"":a)),children:r},`search-${r}-btn`)}))})]})};const _=1e3,q=e=>{let{data:r,loading:a}=e;const l=(0,o.Sx)({sm:["idx","og_artist","sang_on","duration"],md:["idx","og_artist","sang_on"],lg:["idx","og_artist"],xl:[]},"xl");return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(i.Ex,{size:"xs",isIndeterminate:!0,visibility:a?"visible":"hidden",mt:1}),r&&(0,S.jsx)(b.z,{songs:r,rowProps:{hideCol:l},width:"100%",flexGrow:1})]})};function E(){const{t:e}=(0,g.$)(),r=(0,u.useMemo)((()=>[{dataField:"_score",sortBy:"desc",label:e("Relevance")},{dataField:"available_at",sortBy:"desc",label:e("Latest")},{dataField:"available_at",sortBy:"asc",label:e("Oldest")}]),[e]),[a,i]=function(e,r){const[a,l]=(0,u.useState)((()=>{if("undefined"===typeof window)return r;try{const a=window.localStorage.getItem(e);return a?JSON.parse(a):r}catch(a){return console.log(a),r}}));return[a,r=>{try{const t=r instanceof Function?r(a):r;l(t),"undefined"!==typeof window&&window.localStorage.setItem(e,JSON.stringify(t))}catch(t){console.log(t)}}]}("defaultSort",e("Relevance")),b=(0,u.useMemo)((()=>{var e;return(null===(e=r.find((e=>e.label===a)))||void 0===e?void 0:e.label)||r[0].label}),[r,a]),[f,p]=(0,u.useState)(!1),v=(0,x.s0)(),[j,y]=(0,u.useState)(!1),C=(0,o.Sx)({base:"wrap",sm:"wrap",xs:"wrap",md:"nowrap",lg:"nowrap",xl:"nowrap"}),[k]=(0,m.lr)();(0,u.useEffect)((()=>{const e=k.get("ch"),r=k.get("org");y(!!e),p(!!r)}),[k]);const E=(0,u.useCallback)((e=>e?{query:{multi_match:{query:e,fields:["general^2","general.ngram","general.romaji"],type:"most_fields"}}}:{}),[]),Q=(0,u.useCallback)((e=>e?{query:{multi_match:{query:e,fields:["name.ngram^2","name^2","name.romaji"],type:"phrase"}}}:{}),[]),z=(0,u.useCallback)((e=>e?{query:{multi_match:{query:e,fields:["original_artist.ngram^2","original_artist^2","original_artist.romaji"],type:"phrase"}}}:{}),[]);return(0,S.jsx)(l.Z,{className:"m-search",app:"songs_db",url:window.location.origin+"/api/v2/musicdex/elasticsearch",transformRequest:e=>{let{url:r,...a}=e;return a.url="/api/v2/musicdex/elasticsearch/search",a},themePreset:"dark",setSearchParams:e=>{v({search:new URL(e).search})},enableAppbase:!1,children:(0,S.jsxs)(c.kC,{alignItems:"stretch",wrap:C,mt:4,children:[(0,S.jsxs)(c.gC,{minW:"200px",className:"m-filters",alignItems:"stretch",px:2,flexGrow:1,flexBasis:"300px",spacing:2,mr:3,children:[(0,S.jsx)(t.Z,{componentId:"q",URLParams:!0,filterLabel:"Search",customQuery:E,render:r=>(0,S.jsx)(w,{debounceValue:_,placeholder:e("Search for Music / Artist"),getQuery:E,autoFocus:!0,...r}),onError:e=>console.error(e)}),(0,S.jsx)(d.UQ,{allowToggle:!0,defaultIndex:0,children:(0,S.jsxs)(d.Qd,{children:[(0,S.jsxs)(d.KF,{children:[(0,S.jsx)(c.X6,{flex:"1",textAlign:"center",size:"sm",children:e("Advanced Filters")}),(0,S.jsx)(d.XE,{})]}),(0,S.jsx)(d.Hk,{p:0,children:(0,S.jsxs)(c.gC,{alignItems:"stretch",flexGrow:1,spacing:2,children:[(0,S.jsx)(t.Z,{componentId:"isMv",filterLabel:e("Is MV"),URLParams:!0,render:r=>(0,S.jsx)(F,{dataField:"is_mv",tagLabel:e("Type"),buttons:[{label:e("MV"),value:"true",icon:(0,S.jsx)(h.Z0Y,{})},{label:e("Stream"),value:"false",icon:(0,S.jsx)(h.WW5,{})}],...r}),onError:e=>console.error(e)}),(0,S.jsx)(t.Z,{componentId:"song",URLParams:!0,filterLabel:e("Song Name"),customQuery:Q,render:r=>(0,S.jsx)(w,{placeholder:e("Song Name"),debounceValue:_,getQuery:Q,tagLabel:e("Song"),...r}),onError:e=>console.error(e)}),(0,S.jsx)(t.Z,{componentId:"artist",URLParams:!0,filterLabel:e("Original Artist"),customQuery:z,render:r=>(0,S.jsx)(w,{placeholder:e("Original Artist Name"),debounceValue:_,getQuery:z,tagLabel:e("Artist"),...r}),onError:e=>console.error(e)}),(0,S.jsx)(t.Z,{componentId:"ch",filterLabel:e("Channel"),URLParams:!0,react:{and:["q","song","artist","isMv","org"]},defaultQuery:()=>({aggs:{"channel.name":{terms:{field:"channel.name",size:12,order:{_count:"desc"}}}}}),render:r=>(0,S.jsx)(L,{dataField:"channel.name",placeholder:e("Channel name"),tagLabel:e("Channel"),showSearch:!0,...r}),onError:e=>console.error(e)}),!j&&(0,S.jsx)(t.Z,{componentId:"org",filterLabel:e("Org"),URLParams:!0,react:{and:["q","song","artist","isMv"]},defaultQuery:()=>({aggs:{org:{terms:{field:"org",order:{_count:"desc"}}}}}),render:r=>(0,S.jsx)(I,{dataField:"org",placeholder:e("Organization"),tagLabel:e("Organization"),...r}),onError:e=>console.error(e)}),f&&!j&&(0,S.jsx)(t.Z,{componentId:"suborg",filterLabel:e("Suborg"),URLParams:!0,react:{and:["q","song","artist","isMv","org"]},defaultQuery:()=>({aggs:{suborg:{terms:{field:"suborg",order:{_count:"desc"}}}}}),render:r=>(0,S.jsx)(L,{dataField:"suborg",placeholder:e("Suborg name"),tagLabel:e("Suborg"),...r}),onError:e=>console.error(e)})]})})]})})]}),(0,S.jsxs)(c.gC,{minW:"350px",w:"50vw",alignItems:"stretch",flexGrow:2,flexShrink:1,children:[(0,S.jsx)(s.Z,{clearAllLabel:e("Clear filters"),style:{minHeight:35}}),(0,S.jsx)(n.default,{componentId:"results",dataField:"name",react:{and:["q","song","artist",...j?[]:["org"],...f&&!j?["suborg"]:[],"isMv","ch"]},URLParams:!0,pagination:!0,showLoader:!0,size:12,sortOptions:r,defaultSortOption:b,innerClass:{sortOptions:"sort-select",pagination:"custom-chakra-button"},render:q,onQueryChange:(e,a)=>{var l;const t=Object.keys(a.sort[0])[0],s=a.sort[0][t].order;i((null===(l=r.find((e=>e.dataField===t&&e.sortBy===s)))||void 0===l?void 0:l.label)||"unset")}})]})]})})}}}]);
//# sourceMappingURL=462.f34d2fa1.chunk.js.map